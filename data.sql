create database adoc1;

use adoc1;

-- Bảng Categories
CREATE TABLE
    Categories (
        id INT AUTO_INCREMENT PRIMARY KEY,
        name VARCHAR(255) NOT NULL,
        type ENUM ('Pet', 'Service', 'Product') NOT NULL,
        is_active BOOLEAN DEFAULT true,
        createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
    );

-- Bảng Users
CREATE TABLE
    Users (
        id INT AUTO_INCREMENT PRIMARY KEY,
        username VARCHAR(255) NOT NULL,
        password VARCHAR(255) NOT NULL,
        email VARCHAR(255) NOT NULL,
        phone VARCHAR(20),
        role JSON NOT NULL,
        full_name VARCHAR(255),
        date_of_birth DATE,
        address VARCHAR(255),
        avatar_url VARCHAR(255),
        is_active BOOLEAN DEFAULT true,
        is_verified BOOLEAN DEFAULT false,
        last_login TIMESTAMP,
        reset_password_token VARCHAR(255),
        reset_password_expires_at TIMESTAMP,
        verification_token VARCHAR(255),
        verification_token_expires_at TIMESTAMP,
        cccd VARCHAR(20),
        doctor_avatar VARCHAR(255),
        clinic_address VARCHAR(255),
        practice_certificate VARCHAR(255),
        experience_years INT,
        opening_time TIME,
        closing_time TIME,
        cccd_front_image VARCHAR(255),
        cccd_back_image VARCHAR(255),
        certificate_image VARCHAR(255),
        is_doctor_approved BOOLEAN DEFAULT false,
        store_name VARCHAR(255),
        store_address VARCHAR(255),
        business_license VARCHAR(255),
        business_license_url VARCHAR(255),
        store_logo VARCHAR(255),
        store_description TEXT,
        is_store_verified BOOLEAN DEFAULT false,
        createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
    );

-- Bảng Pets
CREATE TABLE
    Pets (
        id INT AUTO_INCREMENT PRIMARY KEY,
        owner_id INT NOT NULL,
        category_id INT NOT NULL,
        name VARCHAR(255) NOT NULL,
        breed VARCHAR(255),
        age INT,
        gender ENUM ('Male', 'Female') NOT NULL,
        description TEXT,
        medical_history TEXT,
        is_active BOOLEAN DEFAULT true,
        images TEXT,
        createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
        FOREIGN KEY (owner_id) REFERENCES Users (id),
        FOREIGN KEY (category_id) REFERENCES Categories (id)
    );

-- Bảng Products
CREATE TABLE
    Products (
        id INT AUTO_INCREMENT PRIMARY KEY,
        sales_center_id INT NOT NULL,
        category_id INT NOT NULL,
        name VARCHAR(255) NOT NULL,
        description TEXT,
        price DECIMAL(10, 2) NOT NULL,
        stock_quantity INT DEFAULT 0,
        sku VARCHAR(255) UNIQUE,
        images TEXT,
        createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
        FOREIGN KEY (sales_center_id) REFERENCES Users (id),
        FOREIGN KEY (category_id) REFERENCES Categories (id)
    );

-- Bảng Orders
CREATE TABLE
    Orders (
        id INT AUTO_INCREMENT PRIMARY KEY,
        petOwner_id INT NOT NULL,
        total_amount DECIMAL(10, 2) NOT NULL,
        status ENUM (
            'Đang xử lý',
            'Chờ thanh toán',
            'Hoàn thành',
            'Hủy',
            'Đã giao',
            'Đang vận chuyển'
        ) DEFAULT 'Pending',
        createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
        FOREIGN KEY (petOwner_id) REFERENCES Users (id)
    );

-- Bảng OrderItems
CREATE TABLE
    OrderItems (
        id INT AUTO_INCREMENT PRIMARY KEY,
        order_id INT NOT NULL,
        product_id INT NOT NULL,
        quantity INT NOT NULL,
        unit_price DECIMAL(10, 2) NOT NULL,
        subtotal DECIMAL(10, 2) NOT NULL,
        createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
        FOREIGN KEY (order_id) REFERENCES Orders (id),
        FOREIGN KEY (product_id) REFERENCES Products (id)
    );

-- Bảng Payments
CREATE TABLE
    Payments (
        id INT AUTO_INCREMENT PRIMARY KEY,
        order_id INT NOT NULL,
        amount DECIMAL(10, 2) NOT NULL,
        payment_method VARCHAR(255),
        status ENUM (
            'Đang xử lý',
            'Hoàn thành',
            'Hủy',
            'Chờ xác nhận',
            'Chờ xử lý',
            'Chờ thanh toán'
        ) DEFAULT 'Đang xử lý',
        transaction_id VARCHAR(255),
        payment_date TIMESTAMP,
        createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
        FOREIGN KEY (order_id) REFERENCES Orders (id)
    );

-- Bảng Posts
CREATE TABLE
    Posts (
        id INT AUTO_INCREMENT PRIMARY KEY,
        petOwner_Id INT NOT NULL,
        title VARCHAR(255) NOT NULL,
        content TEXT NOT NULL,
        image_url VARCHAR(255),
        counterLike INT DEFAULT 0,
        createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
        FOREIGN KEY (petOwner_Id) REFERENCES Users (id)
    );

-- Bảng Comments
CREATE TABLE
    Comments (
        id INT AUTO_INCREMENT PRIMARY KEY,
        post_id INT NOT NULL,
        petOwner_Id INT NOT NULL,
        content TEXT NOT NULL,
        createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
        FOREIGN KEY (post_id) REFERENCES Posts (id),
        FOREIGN KEY (petOwner_Id) REFERENCES Users (id)
    );

-- Bảng Reviews
CREATE TABLE
    Reviews (
        id INT AUTO_INCREMENT PRIMARY KEY,
        petOwner_Id INT NOT NULL,
        product_id INT NOT NULL,
        rating INT CHECK (rating BETWEEN 1 AND 5),
        title VARCHAR(255),
        comment TEXT,
        is_verified_purchase BOOLEAN DEFAULT false,
        createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
        FOREIGN KEY (petOwner_Id) REFERENCES Users (id),
        FOREIGN KEY (product_id) REFERENCES Products (id)
    );

-- Bảng Coupons
CREATE TABLE
    Coupons (
        id INT AUTO_INCREMENT PRIMARY KEY,
        code VARCHAR(255) NOT NULL UNIQUE,
        description TEXT,
        discount_type ENUM ('Percentage', 'FreeShipping') NOT NULL,
        discount_value DECIMAL(10, 2) NOT NULL,
        start_date DATE NOT NULL,
        end_date DATE NOT NULL,
        is_active BOOLEAN DEFAULT true,
        product_id INT,
        createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
        FOREIGN KEY (product_id) REFERENCES Products (id)
    );

-- Bảng Appointments
CREATE TABLE
    Appointments (
        id INT AUTO_INCREMENT PRIMARY KEY,
        pet_owner_id INT NOT NULL,
        pet_id INT NOT NULL,
        doctor_id INT NOT NULL,
        appointment_date DATE NOT NULL,
        appointment_time TIME NOT NULL,
        status ENUM ('Đã đặt lịch', 'Đã hoàn thành', 'Đã hủy') DEFAULT 'Đã đặt lịch',
        notes TEXT,
        createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
        FOREIGN KEY (pet_owner_id) REFERENCES Users (id),
        FOREIGN KEY (pet_id) REFERENCES Pets (id),
        FOREIGN KEY (doctor_id) REFERENCES Users (id)
    );